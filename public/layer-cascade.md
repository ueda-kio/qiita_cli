---
title: layer-cascade
tags:
  - CSS
private: false
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---
# 古くてデカくて詳細度の高い common.css を倒す

## はじめに

### この記事はなに？
CSSのカスケードレイヤーを活用して、詳細度が高いCSSファイルを気にせずに新しいスタイルを適用できる方法を提案します。

### 対象読者
この問題に直面している方々、つまり古くてデカくてムダに詳細度の高いcommon.cssに苦しんでいるウェブ開発者やデザイナーの皆さんを想定しています。特に、既存のスタイルに対して新たなスタイルを適用しようとしている方々には、非常に有用な情報を提供します。

- 歴史のあるウェブサイトを運用している開発者
- 古いCSSファイルの詳細度に苦しんでいる開発者
- 新たなUIを実装したいが、既存のスタイルに邪魔されているデザイナー
- CSSの保守性を向上させたいと考えている全ての開発者

## 「古くてデカくて詳細度の高い common.css 」とは？

古くて大きいCSSファイルとは、歴史のあるウェブサイトで使用されるスタイルシートのひとつで、リリース当初から多くのスタイルが追加されてきました。こういったファイルは「common.css」のようなファイル名がつけられていることが多く、一昔前まではCSS設計という考え方がなかったため、保守性が低いことが一般的です。その結果、詳細度が非常に高くなっていることが多いです。

### なにがこまるの？
新たなUIを実装する際、これらの古いCSSが邪魔をしてくることがよくあります。たとえば common.css に以下のようなスタイルが記述されているとします。

```css
html body div#mainContents div.container p {
  font-size: 14px;
  line-height: 21px;
  color: black;
}
```

上記に該当する全ての `p` 要素にこのスタイルが当たることになります。新たなコンポーネントを実装する際にこれを上書きしようとすると、さらに詳細度の高いセレクタを作成しなければなりません。

具体的には、次のように書く必要が出てきます：

```css
html body div#mainContents div.container p.custom-text {
  font-size: 16px;
  color: blue;
}
```

ここでは `p.custom-text` というクラスを追加することで、特定のスタイルを適用していますが、これによりCSSはどんどん複雑化し、可読性が低下します。さらに、他の開発者がこのスタイルを見たとき、どの部分がどのスタイルに影響しているのかを理解するのが難しくなります。

加えて、古いCSSファイルが多くの場所で使用されている場合、新たに追加したスタイルが他のスタイルと競合することが頻繁に発生します。これにより、意図しないスタイルが適用されたり、修正が必要になったりするため、保守性が著しく低下します。結果的に、開発者はCSSの詳細度を上げ続けることに疲れ果て、プロジェクト全体の管理が一層難しくなってしまいます。

## カスケードレイヤーで倒す

### カスケードレイヤーとは
カスケードレイヤーは、CSSの新しい機能であり、スタイルシート内のルールの適用順序を管理するための仕組みです。イメージとしては、異なる「レイヤー」という格納器を作成し、各レイヤーの中で詳細度の勝ち負けを計算します。各レイヤーには優先順位を設定できるため、たとえ詳細度が高いセレクタであっても、優先順位の低いレイヤーに格納すれば、より優先度の高いレイヤーのスタイルが適用されます。

### どう倒すのか
このカスケードレイヤーを利用して、common.cssを効果的に扱う方法を見ていきましょう。まず、common.cssを「legacy-layer」にまとめることから始めます。これにより、古いスタイルが一つのレイヤーに集約され、新たに実装するUIは別のレイヤーに分けることができます。こうすることで、古いスタイルに干渉されることなく新たなスタイルを追加できるようになります。

- `common.css`を`legacy-layer`にまとめる
- 新たに実装するUIは別の`layer`にまとめる

### 工夫点
common.cssは往々にして修正を加えてはいけないことが多いため、工夫が必要です。すべてのCSSファイルを`@import`しつつレイヤー指定することで、common.css自体を触ることなくレイヤー化することが可能です。以下のように記述することで、レイヤーを導入できます。

```css
// import.css
@layer legacy, component, page;

@import url('./style_legacy.css') layer(legacy);
@import url('./ab.css') layer(page);
```

このようにして、common.cssのスタイルをそのままにしておきながら、新たなスタイルを適用することができます。これにより、保守性が向上し、開発者は新しいUIに集中しやすくなります。

## まとめ
古くてデカくて詳細度の高いcommon.cssは、ウェブ開発において避けがたい問題の一つですが、カスケードレイヤーを利用することで効果的に管理することができます。レイヤーを使うことで、古いスタイルに影響を受けることなく、自由に新しいスタイルを追加できるようになります。これにより、開発の効率が向上し、保守性も高まります。

古いプロジェクトを更新する際には、ぜひカスケードレイヤーを取り入れて、スムーズなCSS管理を実現してみてください。